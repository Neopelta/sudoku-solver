#include "sudoku.h"

//#####                             #####
//####        TEST FUNCTIONS        ####
//#####                             #####
/*
//TEST FOR 9*9 VALID ARRAY

//TEST FOR 9*9 VALID ARRAY
short unsigned int  grilleSudoku9x9[9][9] = {
    {5, 3, 4, 6, 7, 8, 9, 1, 2},
    {6, 7, 2, 1, 9, 5, 3, 4, 8},
    {1, 9, 8, 3, 4, 2, 5, 6, 7},
    {8, 5, 9, 7, 6, 1, 4, 2, 3},
    {4, 2, 6, 8, 5, 3, 7, 9, 1},
    {7, 1, 3, 9, 2, 4, 8, 5, 6},
    {9, 6, 1, 5, 3, 7, 2, 8, 4},
    {2, 8, 7, 4, 1, 9, 6, 3, 5},
    {3, 4, 5, 2, 8, 6, 1, 7, 9}
};

//TEST FOR 16*16 VALID ARRAY
short unsigned int  grilleSudoku16x16[16][16] = {
    {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16},
    {5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 1, 2, 3, 4},
    {9, 10, 11, 12, 13, 14, 15, 16, 1, 2, 3, 4, 5, 6, 7, 8},
    {13, 14, 15, 16, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12},
    {2, 1, 4, 3, 6, 5, 8, 7, 10, 9, 12, 11, 14, 13, 16, 15},
    {6, 5, 8, 7, 10, 9, 12, 11, 14, 13, 16, 15, 2, 1, 4, 3},
    {10, 9, 12, 11, 14, 13, 16, 15, 2, 1, 4, 3, 6, 5, 8, 7},
    {14, 13, 16, 15, 2, 1, 4, 3, 6, 5, 8, 7, 10, 9, 12, 11},
    {3, 4, 1, 2, 7, 8, 5, 6, 11, 12, 9, 10, 15, 16, 13, 14},
    {7, 8, 5, 6, 11, 12, 9, 10, 15, 16, 13, 14, 3, 4, 1, 2},
    {11, 12, 9, 10, 15, 16, 13, 14, 3, 4, 1, 2, 7, 8, 5, 6},
    {15, 16, 13, 14, 3, 4, 1, 2, 7, 8, 5, 6, 11, 12, 9, 10},
    {4, 3, 2, 1, 8, 7, 6, 5, 12, 11, 10, 9, 16, 15, 14, 13},
    {8, 7, 6, 5, 12, 11, 10, 9, 16, 15, 14, 13, 4, 3, 2, 1},
    {12, 11, 10, 9, 16, 15, 14, 13, 4, 3, 2, 1, 8, 7, 6, 5},
    {16, 15, 14, 13, 4, 3, 2, 1, 8, 7, 6, 5, 12, 11, 10, 9}
};

//TEST FOR 16*16 VALID ARRAY
short unsigned int  grilleSudoku16x16_65elem[16][16] = {
    {1, 0, 0, 4, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 6, 0, 0, 0, 0, 0, 0, 0, 0, 15, 0, 0, 0, 0, 0},
    {0, 0, 11, 0, 0, 0, 0, 0, 1, 0, 0, 0, 5, 0, 0, 0},
    {0, 0, 0, 0, 1, 0, 3, 0, 0, 6, 0, 8, 0, 10, 0, 0},
    {0, 0, 0, 0, 6, 0, 0, 0, 0, 0, 0, 11, 0, 0, 0, 15},
    {0, 0, 0, 0, 0, 0, 12, 0, 14, 0, 16, 0, 0, 1, 0, 0},
    {0, 0, 0, 0, 0, 0, 16, 0, 0, 0, 0, 0, 0, 5, 8, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 6, 7, 0, 0, 0, 0, 12, 0},
    {3, 0, 1, 0, 0, 8, 0, 0, 0, 0, 0, 0, 0, 16, 0, 0},
    {0, 0, 0, 0, 0, 12, 0, 0, 0, 0, 0, 0, 3, 0, 0, 0},
    {0, 0, 0, 0, 15, 0, 0, 0, 0, 0, 0, 0, 11, 0, 0, 0},
    {0, 0, 13, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 14, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 13, 0, 0, 0, 5, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 0, 0, 13},
    {0, 0, 0, 16, 0, 0, 0, 0, 8, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 15, 0, 0, 0, 0, 0, 0, 0, 0, 10, 0}
};

short unsigned int grilleSudoku9x9_easy[9][9] = {
    {0, 3, 8, 7, 0, 6, 0, 0, 9},
    {0, 0, 0, 0, 0, 9, 7, 0, 4},
    {0, 0, 9, 1, 2, 3, 6, 0, 5},
    {2, 0, 0, 0, 3, 0, 1, 0, 7},
    {0, 0, 7, 0, 5, 0, 3, 4, 2},
    {9, 0, 0, 4, 0, 0, 5, 6, 0},
    {0, 9, 1, 0, 0, 0, 0, 0, 0},
    {7, 2, 0, 3, 9, 4, 0, 0, 1},
    {0, 0, 5, 0, 1, 7, 0, 0, 0}
};


short unsigned int grilleSudoku9x9_test[9][9] = {
    {0, 5, 0, 9, 0, 0, 0, 0, 0},
    {0, 4, 0, 2, 0, 0, 8, 1, 0},
    {0, 0, 0, 0, 0, 3, 0, 0, 2},
    {7, 0, 4, 0, 0, 0, 0, 9, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 3},
    {0, 0, 0, 7, 0, 0, 0, 5, 8},
    {0, 0, 0, 0, 3, 0, 0, 0, 0},
    {0, 1, 0, 0, 0, 6, 3, 0, 4},
    {6, 8, 0, 5, 0, 0, 0, 0, 0}
};
*/
short unsigned int  grilleSudoku9x9_17elem[9][9] = {
    {0, 0, 0, 0, 0, 0, 0, 1, 0},
    {0, 0, 0, 0, 0, 2, 0, 0, 3},
    {0, 0, 0, 4, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 5, 0, 0},
    {4, 0, 1, 6, 0, 0, 0, 0, 0},
    {0, 0, 7, 1, 0, 0, 0, 0, 0},
    {0, 5, 0, 0, 0, 0, 2, 0, 0},
    {0, 0, 0, 0, 8, 0, 0, 4, 0},
    {0, 3, 0, 9, 1, 0, 0, 0, 0}
};

short unsigned int grilleSudoku9x9_medium[9][9] = {
    {0, 4, 9, 7, 6, 0, 0, 5, 0},
    {0, 0, 0, 4, 1, 5, 0, 2, 0},
    {0, 0, 1, 0, 0, 0, 3, 0, 7},
    {0, 0, 0, 0, 0, 0, 0, 6, 0},
    {0, 7, 0, 0, 9, 0, 0, 8, 0},
    {0, 1, 0, 0, 8, 4, 0, 0, 0},
    {8, 0, 0, 6, 0, 2, 0, 0, 0},
    {0, 2, 7, 8, 0, 0, 0, 0, 4},
    {0, 0, 3, 0, 4, 9, 8, 0, 0}
};

short unsigned int grilleSudoku9x9_hard[9][9] = {
    {0, 0, 0, 0, 8, 0, 0, 0, 3},
    {0, 0, 6, 7, 0, 4, 0, 0, 0},
    {0, 0, 3, 2, 0, 0, 0, 4, 0},
    {1, 0, 9, 4, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 1, 3, 0, 0},
    {5, 0, 0, 0, 0, 6, 0, 0, 7},
    {3, 0, 0, 0, 0, 0, 0, 0, 2},
    {0, 6, 8, 0, 0, 0, 9, 0, 0},
    {0, 2, 5, 1, 9, 0, 0, 0, 0}
};

short unsigned int grilleSudoku9x9_paires_nues[9][9] = {
    {0, 0, 2, 0, 8, 5, 0, 0, 4},
    {0, 0, 0, 0, 3, 0, 0, 6, 0},
    {0, 0, 4, 2, 1, 0, 0, 3, 0},
    {0, 0, 0, 0, 0, 0, 0, 5, 2},
    {0, 0, 0, 0, 0, 0, 3, 1, 0},
    {9, 0, 0, 0, 0, 0, 0, 0, 0},
    {8, 0, 0, 0, 0, 6, 0, 0, 0},
    {2, 5, 0, 4, 0, 0, 0, 0, 8},
    {0, 0, 0, 0, 0, 1, 6, 0, 0}
};

short unsigned int grilleSudoku9x9_paires_cachees[9][9] = {
    {0, 0, 9, 0, 3, 2, 0, 0, 0},
    {0, 0, 0, 7, 0, 0, 0, 0, 0},
    {1, 6, 2, 0, 0, 0, 0, 0, 0},
    {0, 1, 0, 0, 2, 0, 5, 6, 0},
    {0, 0, 0, 9, 0, 0, 0, 0, 0},
    {0, 5, 0, 0, 0, 0, 1, 0, 7},
    {0, 0, 0, 0, 0, 0, 4, 0, 3},
    {0, 2, 6, 0, 0, 9, 0, 0, 0},
    {0, 0, 5, 8, 7, 0, 0, 0, 0}
};

short unsigned int grilleSudoku9x9_triplets_nus[9][9] = {
    {3, 7, 0, 0, 0, 0, 0, 9, 0},
    {9, 0, 0, 0, 7, 0, 0, 0, 0},
    {0, 0, 0, 4, 2, 0, 0, 0, 6},
    {0, 0, 1, 0, 8, 4, 2, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0},
    {8, 0, 0, 6, 0, 0, 0, 5, 0},
    {0, 0, 6, 0, 0, 2, 0, 1, 0},
    {0, 0, 0, 0, 0, 0, 0, 3, 9},
    {0, 5, 0, 0, 0, 0, 4, 0, 0}
};

short unsigned int grilleSudoku9x9_triplets_cachees[9][9] = {
    {0, 0, 8, 0, 0, 7, 0, 0, 0},
    {0, 4, 2, 0, 0, 5, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 3, 0, 0, 6, 8, 0, 1},
    {0, 0, 0, 0, 0, 0, 0, 0, 6},
    {9, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 8, 0, 1, 3, 0, 4, 7, 0},
    {0, 0, 0, 0, 9, 0, 0, 0, 0},
    {0, 1, 0, 0, 0, 0, 0, 0, 0}
};

short unsigned int grilleSudoku9x9_test[9][9] = {
    {0, 0, 0, 0, 7, 0, 1, 0, 0},
    {0, 0, 0, 1, 0, 0, 0, 0, 4},
    {0, 0, 0, 0, 0, 6, 0, 7, 0},
    {0, 7, 0, 0, 9, 0, 8, 0, 0},
    {4, 0, 0, 0, 0, 0, 0, 5, 0},
    {0, 0, 2, 3, 0, 0, 0, 9, 6},
    {0, 0, 3, 2, 0, 0, 0, 0, 7},
    {0, 5, 0, 0, 8, 0, 9, 0, 0},
    {1, 0, 0, 0, 0, 9, 0, 6, 0}
};


short unsigned int grilleSudoku9x9_vide[9][9] = {
    {0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0},
    {0, 0, 0, 0, 0, 0, 0, 0, 0}
};



/**
 * \fn int main (int)
 * \brief Entrée du programme.
 *
 * \return EXIT_SUCCESS - Arrêt normal du programme.
 */
int main(){

    // Declaration of the sudoku grid
    grid tab = allocateGrid2D(SIZE);

    //Copies the Sudoku grid into the array 'tab'.
    for (int i = 0; i < SIZE; i++) {
        for (int j = 0; j < SIZE; j++) {
           set_value_of_case(&tab[i][j], grilleSudoku9x9_17elem[i][j]); // <<----  Modify the Sudoku grid here
        }
    }

    initializeNotes();

    printf("Grille de Sudoku %d*%d :\n", SIZE, SIZE);
    print_grid(tab);
    isValid(tab);
    printf("\n\n");

    clock_t begin = clock();
    int n=0;
    fillNotes(tab);
    int check2 = -1;
    while (!isCompleteSudoku(tab) && check2 != 0) {
        int check1 = -1;
        int i=0;
        do {
            check1 = SingletonMethode(tab);
            n+=check1;
        } while (check1 != 0);

        do {
            i++;
        } while (i <= SIZE_SQUARE && findKuplet(tab,i) == 0);

        if (i > SIZE_SQUARE){
            int j = 0;
            do {
                j++;
            } while (j <= SIZE_SQUARE && boxKReduction(tab,j) == 0);
            
            if (j > SIZE_SQUARE){
                if (xWing(tab) == 0)
                    backtracking(tab);    
            }
        }
    }

    clock_t end = clock();
    // printNotes(tab); //pour debug
    printf("\n\n");
    unsigned long elapsed_seconds = (unsigned long)difftime(end,begin) * 1000.0 / CLOCKS_PER_SEC;

    print_grid(tab);

    printf("Finished in %ld ms with %d additions\n", elapsed_seconds,n);
    //Frees the memory
    free_grid(tab,SIZE);
    freeTabNotes();
    return EXIT_SUCCESS;
}
